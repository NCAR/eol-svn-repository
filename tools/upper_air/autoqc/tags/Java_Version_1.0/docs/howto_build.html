<html>
<head>
   <title>How To: Build/Develop the Auto QC</title>
   <link rel="stylesheet" type="text/css" href="http://dmg.eol.ucar.edu/css/howto.css" />
</head>
<body>
<h1>How To: Build/Develop the Auto QC</h1>

<a name="top"></a>
<h2>Contents</h2>
<ol>
    <li><a href="#about">About</a></li>
    <li><a href="#build">Build</a></li>
    <li><a href="#develop">Development</a></li>
    <li><a href="#process">The QC Process</a></li>
    <li><a href="#properties">The Properties File</a></li>
</ol>
<hr />

<a name="about"></a>
<h2>About</h2>
<p>This document contains information that may be useful for anyone going to work on the development of the Auto QC.  This includes upgrading existing pieces or adding new QC classes to the set.</p>
<p>The software described in this document is written in Java 1.5 with the use of generics.  Java 1.5 or newer is required for the software to run.</p>
<p>The Auto QC software is designed to allow the base QC to be extended to handle special cases of ESC formatted data that may require slightly different processes to QC the soundings properly.</p>

<p><a href="#top">Top</a></p>
<hr />


<a name="build"></a>
<h2>Build</h2>
<p>The build is defined in the <i>build.xml</i> file and uses Ant.  If you have not configured Ant in your environment, you will need to follow the instructions <a href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/how-to/ant-setup-and-use/#environment">here</a> or you won't be able to build the QC with Ant.</p>

<h3>Directory Layout</h3>
<table class="directories">
   <tr>
      <th>build</th>
      <td>This directory may not exist initially is is removed when the <span class="softwareName">clean</span> command is run.  It contains the .class files generated after compiling the .java source.</td>
   </tr>
   <tr>
      <th>dist</th>
      <td>This directory is generated by the build when the jar file is being prepared for production.  This is used so the user can check the contents and layout before deploying it into production.  This directory is removed when the <span class="softwareName">clean</span> command is run.</td>
   </tr>
   <tr>
      <th>docs</th>
      <td>This directory contains all of the documentation for the Auto QC.  It also contains an API directory which is automatically generated during the creation of the javadoc and is removed when the <span class="softwareName">clean</span> command is executed.</td>
   </tr>
   <tr>
      <th>properties</th>
      <td>This direction contains test property files used by the JUnit tests for testing various parts of the Auto QC.  Most of these files contain some problem that is being tested for and should not be used as an example for the actual properties file.</td>
   </tr>
   <tr>
      <th>src</th>
      <td>This directory contains all of the .java source files for the Auto QC.</td>
   </tr>
   <tr>
      <th>tests</th>
      <td>This directory contains the JUnit .java source files used for testing the Auto QC.  This does not contain any production software.</td>
   </tr>
</table>

<h3>build.xml Targets</h3>
<table class="directories">
   <tr>
      <th>clean</th>
      <td>Remove all generated content from the working area.  This removes the build, dist, and docs/api directories.</td>
   </tr>
   <tr>
      <th>compile</th>
      <td>Compile the Auto QC source code and prepare it for execution.  The .class files are put into the build direction.</td>
   </tr>
   <tr>
      <th>compileTests</th>
      <td>Compile the Auto QC test source code and prepare it to be run.  This requires the source files to be compiled and will perform the operation if necessary.</td>
   </tr>
   <tr>
      <th>deploy</th>
      <td>Copy the jar file to the production area and replace all of the public javadoc with a newly generated copy.  This will perform all necessary operations to create the jar file and generate the javadocs that have not already been performed.</td>
   </tr>
   <tr>
      <th>dist</th>
      <td>Generate the jar file to be used in production.  This will compile the .java files if they have not already been created.  The jar file does not contain any test software.</td>
   </tr>
   <tr>
      <th>javadoc</th>
      <td>Create the javadoc files for the non-test files.  This also copies all how tos listed in the overview with the API.  The files are added to the docs/api directory so the directory contents can be copied to the public area on deployment.</td>
   </tr>
   <tr>
      <th>test</th>
      <td>Execute the JUnit tests for the Auto QC.  All failures need to be addressed before the jar file is deployed.</td>
   </tr>
</table>


<p><a href="#top">Top</a></p>
<hr />


<a name="develop"></a>
<h2>Development</h2>
<p>The ESCAutoQC class is designed as an abstract class to allow it to be extended to handle different types of soundings.  This allows for special cases to be made for certain sets of soundings without making changes to the main QC class.</p>
<p>The QC also uses a properties file that is specified as the first argument to the program.  This file contains the set of limits and constants for the QC to use for the specific group of soundings.  This allows the QC to have one set of software work on a multitude of different soundings without having to change any of the source code and needing to recompile.</p>

<p><a href="#top">Top</a></p>
<hr />


<a name="process"></a>
<h2>The QC Process</h2>
<p>Each sounding goes through four stages during the QC:  format checking, value testing, rate testing, and post process/NWS tests.</p>
<p>The first stage is the format checking.  This is done through the ESCSoundingParser used by the QC.  It ensures that the lines are in the correct location and are properly formatted.  The format checking also compares the flags with their associated values.  A sounding that is not properly formatted or flagged correctly, will not be QC'ed any further.</p>
<p>The second stage is value testing.  The value tester compares the values of the record to quantities defined by the properties file and will set flags accordingly.  For some values, the comparisons will force the value or related values to be set as missing.</p>
<p>The third stage is rate checking.  These tests are inter-record checks for acceptable changes between the records.  These tests include rapid pressure changes, differences in ascent rate, checks in the super adiabatic lapse rate, rapid temperature changes, decreasing pressure checks, increases in altitude, and always increasing/decreasing time values.</p>
<p>The final stage is post QC/NWS checks.  This was specifically added to handle extra checks required by the MicroArt NWS soundings.  This can include any special checks required by the sounding that were not performed as part of the base QC.</p>

<p><a href="#top">Top</a></p>
<hr />


<a name="properties"></a>
<h2>The Properties File</h2>
<p>The ESCAutoQC class requires a special properties file that is passed as the first argument to the <span class="softwareName">main</span> function.  This file contains the set of key/value pairs that specify the limits the QC is to use for the soundings.</p>

<h3>Property Key Definitions</h3>
<table border="1" width="100%">
   <tr>
      <th align="center">Key Name</th>
      <th>Valid Values</th>
      <th>Description</th>
   </tr>
   <tr>
      <th>ADIABATIC_LAPSE_RATE</th>
      <td>Double</td>
      <td>A constant used for calculating the lapse rate for the super adiabatic lapse rate, rapid temperature and rapid pressure changes..</td>
   </tr>
   <tr>
      <th>AVERAGING_VALUE</th>
      <td>Positive Integer</td>
      <td>The number of records above the current record to use in rate checking.</td>
   </tr>
   <tr>
      <th>BAD_ASCENT_RATE_CHANGE</th>
      <td>Double</td>
      <td>The threshold such that the absolute value of a change in ascent rate greater than or equal to the threshold is considered BAD.</td>
   </tr>
   <tr>
      <th>BAD_LAPSE_RATE</th>
      <td>Double</td>
      <td>The threshold such that a lapse rate * 1000 greater than or equal to the threshold is considered to be BAD.  This is for pressure values over 10 mb from the surface pressure.</td>
   </tr>
   <tr>
      <th>BAD_RAPID_PRESSURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that a change in pressure greater than or equal to the threshold is considered BAD.</td>
   </tr>
   <tr>
      <th>BAD_RAPID_TEMPERATURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that the lapse rate * 1000 is greater than or equal to the threshold is considered a BAD rapid temperature increase.  This is for pressures below the stratosphere in HOT latitudes and between the stratosphere and surface in COLD latitudes.</td>
   </tr>
   <tr>
      <th>BAD_STRAT_RAPID_TEMPERATURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that the lapse rate * 1000 is greater than or equal to the threshold is considered a BAD rapid temperature increase.  This is for pressures above the stratosphere pressure value.</td>
   </tr>
   <tr>
      <th>BAD_SURFACE_LAPSE_RATE</th>
      <td>Double</td>
      <td>The threshold such that a lapse rate * 1000 greater than or equal to the threshold is considered to be BAD.  This is for pressure values within 10 mb of the surface pressure.</td>
   </tr>
   <tr>
      <th>BAD_SURFACE_RAPID_TEMPERATURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that the lapse rate * 1000 is greater than or equal to the threshold is considered a BAD rapid temperature increase.  This is for pressures below the surface pressure value in COLD latitudes.</td>
   </tr>
   <tr>
      <th>DECREASING_PRESSURE_CHECK</th>
      <td>Double</td>
      <td>The pressure threshold that any pressure less than or equal to the threshold can have equal pressures with out causing problems.  Pressures over the threshold may also allow equal pressure by the implementation of isDecreasingPressure in the subclass.</td>
   </tr>
   <tr>
      <th>LAPSE_RATE_DIFFERENCE</th>
      <td>Double</td>
      <td>A threshold such that the a change in temperature greater than the threshold may cause a flagable super adiabatic lapse rate.</td>
   </tr>
   <tr>
      <th>LAPSE_RATE_LIMIT</th>
      <td>Double</td>
      <td>A constant used in calculating the super adiabatic lapse rate.</td>
   </tr>
   <tr>
      <th>LATITUDE_TYPE</th>
      <td>COLD or HOT</td>
      <td>It specifies what latitude the soundings were released in to properly handle rate checks in the upper atmosphere.</td>
   </tr>
   <tr>
      <th>MAXIMUM_BAD_WIND_SPEED</th>
      <td>Double</td>
      <td>The wind speed threshold such that a wind speed or absolute value of a wind component greater than or equal to the threshold causes the value to be flagged BAD.</td>
   </tr>
   <tr>
      <th>MAXIMUM_MISSING_DEW_POINT</th>
      <td>Double</td>
      <td>The dew point threshold such that any dew point greater than or equal to the threshold is set to the missing value along with the relative humidity value.</td>
   </tr>
   <tr>
      <th>MAXIMUM_MISSING_PRESSURE</th>
      <td>Double</td>
      <td>The pressure threshold such that any pressure greater than or equal to the threshold is replaced with the missing value.</td>
   </tr>
   <tr>
      <th>MAXIMUM_MISSING_TEMPERATURE</th>
      <td>Double</td>
      <td>The temperature threshold such that any temperature greater than or equal to the threshold is replaced with the missing value.</td>
   </tr>
   <tr>
      <th>MAXIMUM_MISSING_WIND_SPEED</th>
      <td>Double</td>
      <td>The wind speed threshold such that a wind speed greater than or equal to the threshold is replaced with the missing value.</td>
   </tr>
   <tr>
      <th>MAXIMUM_QUESTIONABLE_ALTITUDE</th>
      <td>Double</td>
      <td>The altitude threshold such that any altitude greater than the threshold is considered QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MAXIMUM_QUESTIONABLE_ASCENT_RATE</th>
      <td>Double</td>
      <td>The ascent rate threshold such than any ascent rate greater than the threshold is considered QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MAXIMUM_QUESTIONABLE_DEW_POINT</th>
      <td>Double</td>
      <td>The dew point threshold such that any dew point greater than the threshold causes the relative humidity to be flagged QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MAXIMUM_QUESTIONABLE_PRESSURE</th>
      <td>Double</td>
      <td>The pressure threshold such that any pressure greater than the threshold is to be flagged BAD.</td>
   </tr>
   <tr>
      <th>MAXIMUM_QUESTIONABLE_TEMPERATURE</th>
      <td>Double</td>
      <td>The temperature threshold such that any temperature greater than the threshold is to be flagged QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MAXIMUM_QUESTIONABLE_WIND_SPEED</th>
      <td>Double</td>
      <td>The wind speed threshold such that a wind speed or absolute value of a wind component greater than the threshold is to be flagged QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MINIMUM_QUESTIONABLE_ALTITUDE</th>
      <td>Double</td>
      <td>The altitude threshold such that any altitude less than the threshold is considered QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MINIMUM_QUESTIONABLE_PRESSURE</th>
      <td>Double</td>
      <td>The pressure threshold such that any pressure less than the threshold is to be flagged BAD.</td>
   </tr>
   <tr>
      <th>MINIMUM_QUESTIONABLE_TEMPERATURE</th>
      <td>Double</td>
      <td>The temperature threshold such that any temperature less than the threshold is to be flagged QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>MINIMUM_QUESTIONABLE_WIND_SPEED</th>
      <td>Double</td>
      <td>The wind speed threshold such that any wind speed less than the threshold is to be flagged QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>PRESSURE_LIMIT</th>
      <td>Double</td>
      <td>The value that defines the stratosphere pressure line for rapid temperature changes.</td>
   </tr>
   <tr>
      <th>QUESTIONABLE_ASCENT_RATE_CHANGE</th>
      <td>Double</td>
      <td>The threshold such that the absolute value of the change in ascent rate greater than the threshold is considered QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>QUESTIONABLE_LAPSE_RATE</th>
      <td>Double</td>
      <td>The threshold such that a lapse rate * 1000 is greater than or equal to the threshold is considered to be QUESTIONABLE.  This is for pressure values over 10 mb from the surface pressure.</td>
   </tr>
   <tr>
      <th>QUESTIONABLE_RAPID_PRESSURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that a change in pressure greater than or equal to the threshold is considered QUESTIONABLE.</td>
   </tr>
   <tr>
      <th>QUESTIONABLE_SURFACE_LAPSE_RATE</th>
      <td>Double</td>
      <td>The threshold such that a lapse rate * 1000 is greater than or equal to the threshold is considered to be QUESTIONABLE.  This is for pressure values within 10 mb of the surface pressure.</td>
   </tr>
   <tr>
      <th>RAPID_TEMPERATURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that the lapse rate * 100 is greater than or equal to the threshold is considered a QUESTIONABLE rapid temperature increase.  This is for pressures below the stratosphere value in HOT latitudes and between the stratosphere and surface values in COLD latitudes.</td>
   </tr>
   <tr>
      <th>STRAT_RAPID_TEMPERATURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that the lapse rate * 100 is greater than or equal to the threshold is considered a QUESTIONABLE rapid temperature increase.  This is for pressures above the stratosphere pressure value.</td>
   </tr>
   <tr>
      <th>SURFACE_PRESSURE_LIMIT</th>
      <td>Double</td>
      <td>The value that defines the surface pressure line for rapid temperature changes in COLD latitudes.</td>
   </tr>
   <tr>
      <th>SURFACE_RAPID_TEMPERATURE_INCREASE</th>
      <td>Double</td>
      <td>The threshold such that the lapse rate * 100 is greater than or equal to the threshold is considered a QUESTIONABLE rapid temperature increase.  This is for pressures below the surface pressure limit in COLD latitudes.</td>
   </tr>
</table>

<p><a href="#top">Top</a></p>
<hr />

<p class="foot">Last Updated: August 16, 2007 - jclawson</p>

</body>
</html>
